<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>مدیریت کاربران</title>
    <style>
        /* استایل‌های ساده برای جدول و فرم */
        table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 8px; }
        th { background: #eee; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h2>مدیریت کاربران</h2>

    <!-- بارگذاری فایل اکسل کاربران (فقط کاربر) -->
    <div>
        <label>بارگذاری فایل اکسل کاربران:</label>
        <input type="file" id="excel-upload">
        <a href="sample.xlsx" download>دانلود نمونه فایل اکسل کاربران</a>
        <button id="import-users">وارد کردن کاربران</button>
        <button id="delete-all-users">حذف همه کاربران غیرادمین</button>
    </div>

    <!-- افزودن کاربر جدید -->
    <h3>افزودن کاربر جدید</h3>
    <form id="add-user-form">
        <label>نام کاربری:</label>
        <input type="text" id="username" required>
        <label>رمز عبور:</label>
        <input type="password" id="password" required>
        <!-- فیلد نقش حذف شد -->
        <button type="submit">ذخیره</button>
    </form>

    <!-- جدول کاربران -->
    <h3>لیست کاربران</h3>
    <table id="users-table">
        <thead>
            <tr>
                <th>شناسه</th>
                <th>نام کاربری</th>
                <th>نقش</th>
                <th>عملیات</th>
            </tr>
        </thead>
        <tbody id="users-tbody">
            <!-- ردیف کاربران اینجا درج می‌شود -->
        </tbody>
    </table>

    <script>
        // فرض: لیست کاربران از سمت سرور یا فایل CSV بارگذاری می‌شود
        // نمونه داده برای نمایش (در عمل باید از دیتابیس یا فایل بارگذاری شود)
        const users = [
            {id: 1, username: 'admin', role: 'admin'},
            {id: 55, username: '666', role: 'user'},
            {id: 56, username: '777', role: 'user'},
            {id: 57, username: '888', role: 'user'},
            {id: 59, username: '444', role: 'user'},
            {id: 60, username: '555', role: 'user'},
            {id: 90, username: 'ali', role: 'user'}
        ];

        // نمایش کاربران در جدول
        function renderUsers() {
            const tbody = document.getElementById('users-tbody');
            tbody.innerHTML = '';
            users.forEach(user => {
                // کاربران ادمین فقط نمایش داده می‌شوند، بدون دکمه حذف/ویرایش
                let ops = '';
                if (user.role !== 'admin') {
                    ops = `<button onclick="editUser(${user.id})">ویرایش</button>
                           <button onclick="deleteUser(${user.id})">حذف</button>`;
                }
                tbody.innerHTML += `
                    <tr>
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.role === 'admin' ? 'ادمین' : 'کاربر'}</td>
                        <td>${ops}</td>
                    </tr>
                `;
            });
        }

        renderUsers();

        // افزودن کاربر جدید (فقط با نقش کاربر)
        document.getElementById('add-user-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            // نقش به طور پیش‌فرض user ذخیره می‌شود
            users.push({
                id: users.length ? users[users.length - 1].id + 1 : 2,
                username: username,
                role: 'user'
            });
            renderUsers();
            this.reset();
        });

        // حذف کاربر (فقط کاربران غیرادمین)
        function deleteUser(id) {
            const idx = users.findIndex(u => u.id === id);
            if (idx !== -1 && users[idx].role !== 'admin') {
                users.splice(idx, 1);
                renderUsers();
            }
        }

        // ویرایش کاربر (نمونه ساده)
        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (user && user.role !== 'admin') {
                const newUsername = prompt('نام کاربری جدید:', user.username);
                if (newUsername) {
                    user.username = newUsername;
                    renderUsers();
                }
            }
        }

        // حذف همه کاربران غیرادمین
        document.getElementById('delete-all-users').addEventListener('click', function() {
            for (let i = users.length - 1; i >= 0; i--) {
                if (users[i].role !== 'admin') users.splice(i, 1);
            }
            renderUsers();
        });

        // بارگذاری فایل اکسل و سایر امکانات بدون تغییر باقی می‌ماند
    </script>
</body>
</html>
